{% extends 'form.html' %} {% block formTitle %} Differentially Private Machine
Learning {% endblock %} {% block formFields %}

<section class="parameter-section" id="function-type">
  <header class="section-header">
    <h6>Select Mechanism</h6>
  </header>
  <div class="d-flex justify-content-center functions tab-select">
    <label class="btn btn-outline" for="function-logreg" data-control="logreg"
      >Logistic Regression</label
    >
    <label
      class="btn btn-outline"
      for="function-NaiveBayes"
      data-control="NaiveBayes"
      >Naive Bayes</label
    >
    <label class="btn btn-outline" for="function-kMeans" data-control="kMeans"
      >k-means</label
    >
    <div class="d-none tab-radios">
      <input
        type="radio"
        class="tab-radio"
        value="logreg"
        id="function-logreg"
        name="function"
        required
      />
      <input
        type="radio"
        class="tab-radio"
        value="NaiveBayes"
        id="function-NaiveBayes"
        name="function"
        required
      />
      <input
        type="radio"
        value="kMeans"
        id="function-kMeans"
        name="function"
        class="tab-radio"
        required
      />
    </div>
  </div>
</section>
<section class="parameter-section" id="privacy-parameters">
  <header class="section-header">
    <h6>Privacy parameters</h6>
  </header>
  <div>
    <div class="form-row align-items-center my-3">
      <div class="col-auto">
        <div class="input-group parameter-input">
          <div class="input-group-prepend">
            <label for="epsilon" class="input-group-text">Epsilon</label>
          </div>
          <input
            type="number"
            class="form-control range-value"
            id="epsilon"
            min="0"
            max="100"
            step="0.001"
            placeholder="0"
            data-inclusive-min="False"
            required
            data-toggle="tooltip"
            data-trigger="manual"
            data-placement="top"
            data-title="Epsilon cannot be 0!"
          />
        </div>
      </div>
      <input
        type="range"
        class="custom-range col"
        min="0"
        max="100"
        step="0.5"
        id="epsilon-range"
        value="0"
      />
    </div>
  </div>
</section>
<section class="parameter-section" id="learning-parameters">
  <header class="section-header">
    <h6>Learning Hyperparameters</h6>
  </header>
  <div>
    <div class="form-row my-4 justify-content-around">
      <div class="col-auto my-3" data-hide="NaiveBayes kMeans">
        <div class="input-group parameter-input">
          <div class="input-group-prepend">
            <label for="lambda" class="input-group-text">Lambda</label>
          </div>
          <input
            type="number"
            class="form-control"
            id="lambda"
            required
            placeholder="0"
            required
          />
        </div>
      </div>
      <div class="col-auto my-3" data-hide="NaiveBayes kMeans">
        <div class="input-group parameter-input">
          <div class="input-group-prepend">
            <label for="degree" class="input-group-text">Degree</label>
          </div>
          <input
            type="number"
            class="form-control"
            id="degree"
            required
            placeholder="0"
          />
        </div>
      </div>
      <div class="col-12"></div>
      <div class="col-auto my-3" data-hide="NaiveBayes kMeans">
        <div class="input-group parameter-input">
          <div class="input-group-prepend">
            <label for="epochs" class="input-group-text">Epochs</label>
          </div>
          <input
            type="number"
            class="form-control"
            id="epochs"
            required
            placeholder="0"
          />
        </div>
      </div>
      <div class="col-auto my-3" data-hide="NaiveBayes kMeans">
        <div class="input-group parameter-input">
          <div class="input-group-prepend">
            <label for="alpha" class="input-group-text">Alpha</label>
          </div>
          <input
            type="number"
            class="form-control"
            id="alpha"
            required
            placeholder="0"
          />
        </div>
      </div>
      <div class="col-auto my-3" data-hide="NaiveBayes logreg">
        <div class="input-group parameter-input">
          <div class="input-group-prepend">
            <label for="clusters" class="input-group-text">Clusters</label>
          </div>
          <input
            type="number"
            class="form-control"
            id="clusters"
            required
            placeholder="0"
          />
        </div>
      </div>
    </div>
    <div class="form-row align-items-center my-3">
      <div class="col-auto">
        <div class="input-group parameter-input">
          <div class="input-group-prepend">
            <label for="split" class="input-group-text">Split Ratio</label>
          </div>
          <input
            type="number"
            class="form-control range-value"
            id="split"
            min="0"
            max="1"
            placeholder="0"
            step="0.05"
            required
          />
        </div>
      </div>
      <input
        type="range"
        class="custom-range col"
        min="0"
        max="1"
        step="0.05"
        id="split-range"
        value="0"
      />
    </div>
  </div>
</section>
<section class="parameter-section" id="learning-parameters" data-hide="logreg">
  <header class="section-header">
    <h6>Bounds</h6>
  </header>
  <div>
    <div class="form-row my-4 justify-content-around">
      <div class="col-auto my-3">
        <div class="input-group parameter-input">
          <div class="input-group-prepend">
            <label for="upper-bound" class="input-group-text">Upper</label>
          </div>
          <input
            type="number"
            class="form-control"
            id="upper-bound"
            placeholder="0"
            required
          />
        </div>
      </div>
      <div class="col-auto my-3">
        <div class="input-group parameter-input">
          <div class="input-group-prepend">
            <label for="lower-bound" class="input-group-text">Lower</label>
          </div>
          <input
            type="number"
            class="form-control"
            id="lower-bound"
            required
            placeholder="0"
          />
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %} {% block analysisScript %}

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script
  id="MathJax-script"
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
></script>
<script type="text/javascript">
  let promise = Promise.resolve(); // Used to hold chain of typesetting calls

  function typeset(code) {
    promise = promise
      .then(() => {
        code();
        return MathJax.typesetPromise();
      })
      .catch(err => console.log(err));
    return promise;
  }
  function get_row(row, last = 0) {
    result = [];
    if (typeof row == "number") {
      return parseFloat(row).toPrecision(4);
    } else {
      $.each(row, function(index, value) {
        result.push(parseFloat(value).toPrecision(4));
      });
      return result.join(" & ");
    }
  }
  function Analysis3() {
    console.log("in");
    console.log($(".upload-form"));
    var xhttp = new XMLHttpRequest();
    var func = $("input[name='function']:checked").val();
    var e = document.getElementById("epsilon").value;
    var lambda = document.getElementById("lambda").value;
    var degree = document.getElementById("degree").value;
    var epochs = document.getElementById("epochs").value;
    var alpha = document.getElementById("alpha").value;
    var split = document.getElementById("split").value;
    clusters = $("#clusters").val();
    upper_bound = $("#upper-bound").val();
    lower_bound = $("#lower-bound").val();
    if (!$(".upload-form")[0].checkValidity()) {
      console.log("false");
      $(".upload-form").addClass("was-validated");
      return;
    }
    $(".data-graph")
      .addClass("visual-loading")
      .removeClass("visual-available process-error");
    $("#Analyze-Button")
      .prop("disabled", true)
      .addClass("disabled");
    $("label[for='display-visual']").click();
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4) {
        if (this.status == 200) {
          result = JSON.parse(this.responseText);
          console.log(result);
          if (result["error"]) {
            $(".data-graph").addClass("process-error");
            $(".graph-pre-caption .error-caption").text(
              "Oops! " + result["text"]
            );
          } else {
            typeset(() => {
              a = result["theta"];
              console.log(a);
              last = a.pop();
              if (a.length >= 10) {
                a = a.slice(0, 8);
                a.push("\\vdots");
                console.log("more");
                console.log(b);
              }
              t = "$$Weights=\\left[\\begin{array}{cc} ";
              $.each(a, function(index, value) {
                t += get_row(value) + " \\\\ ";
              });
              // t = t.substring(1, -2);
              t += get_row(last) + " \\end{array}\\right]$$";
              console.log(t);
              math = $(".weights");
              math.empty();
              a = $("<p/>");
              a.html(t).appendTo(math);
              return math[0];
            });
            $(".weights").show();
            console.log();
            $(".training-accuracy").html(
              "Training Accuracy: " +
                parseFloat(result["train_accuracy"]).toFixed(3) +
                "%"
            );
            $(".test-accuracy").text(
              "Test Accuracy: " +
                parseFloat(result["test_accuracy"]).toFixed(3) +
                "%"
            );
            $(".displays.tab-select").css("display", "flex");
            $("#data-histogram")
              .attr("src", result["image"])
              .show();
            $(".data-graph").addClass("visual-available");
          }
        } else {
          $(".data-graph").addClass("process-error");
          $(".graph-pre-caption .error-caption").text(
            "Oops! Something went wrong on our side!"
          );
        }
        $(".data-graph").removeClass("visual-loading");
        $("#Analyze-Button")
          .prop("disabled", false)
          .removeClass("disabled");
      }
    };
    xhttp.open(
      "GET",
      "/" +
        func +
        "_process?e=" +
        e +
        "&lambda=" +
        lambda +
        "&degree=" +
        degree +
        "&epochs=" +
        epochs +
        "&alpha=" +
        alpha +
        "&split=" +
        split +
        "&clusters=" +
        clusters +
        "&upper=" +
        upper_bound +
        "&lower=" +
        lower_bound,
      true
    );
    xhttp.send();
  }
</script>
{% endblock %}
